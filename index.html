<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>5 Night's at Starr's: REIMAGINED</title>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.12.0/brython.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.12.0/brython_stdlib.js"></script>
    <style>
        :root { --main-color: #FFFB00; --bg-color: #050505; }
        body { background-color: var(--bg-color); color: var(--main-color); font-family: 'Courier New', monospace; margin: 0; padding: 10px; display: flex; flex-direction: column; height: 100vh; overflow: hidden; transition: color 0.3s; }
        
        /* Mobile UI Fixes */
        #top-ui { width: 100%; display: flex; gap: 8px; margin-bottom: 10px; height: 55px; flex-shrink: 0; }
        #user-input { flex-grow: 1; background: #111; color: inherit; border: 2px solid currentColor; padding: 12px; font-size: 16px; outline: none; border-radius: 4px; }
        
        /* High-Visibility SEND Button */
        #send-btn { 
            width: 90px; 
            background-color: var(--main-color) !important; 
            color: #000 !important; 
            border: none; 
            font-weight: bold; 
            border-radius: 4px; 
            cursor: pointer;
            font-size: 16px;
        }
        
        #game-output { background-color: #000; color: inherit; padding: 15px; border: 2px solid currentColor; flex-grow: 1; overflow-y: auto; white-space: pre-wrap; font-size: 14px; position: relative; box-shadow: inset 0 0 10px #222; }

        /* Hacked State Effects */
        .hacked { --main-color: #00FF00 !important; animation: glitch-shake 0.1s infinite; }
        @keyframes glitch-shake {
            0% { transform: translate(0,0); opacity: 1; }
            25% { transform: translate(-2px, 1px); opacity: 0.9; }
            75% { transform: translate(2px, -1px); opacity: 1; }
            100% { transform: translate(0,0); }
        }
        .corrupt-banner { color: #00FF00; font-weight: bold; border: 2px solid #00FF00; padding: 8px; display: block; margin-bottom: 15px; text-align: center; text-transform: uppercase; }
        
        .maint-btn { background: var(--main-color); color: #000; border: none; padding: 12px; margin: 5px; border-radius: 4px; font-weight: bold; font-family: 'Courier New'; }
    </style>
</head>
<body onload="brython()">
    <div id="top-ui">
        <input type="text" id="user-input" placeholder="COMMAND..." autocomplete="off">
        <button id="send-btn">SEND</button>
    </div>
    <div id="game-output">SYSTEM READY. TYPE 1 TO START.</div>

<script type="text/python">
from browser import document, window, timer, html
import random

# --- GAME DATA & LORE ---
cam_names = ["Stage", "Play Area", "Arcade", "L Hall", "R Hall", "L Door", "R Door", "Parts"]
death_quotes = {
    "Starr Baby": "That's what you get for stealing my spotlight...",
    "Diamond Diva": "You were no match for my elegance...",
    "Princess Pinky": "Thought you could hide from me..?",
    "Penelope Purple": "Purple is the colour of revenge and despair...",
    "Glitch Starr": "Oh wow! I didn't even try to hack those systems and you still reset them..!"
}

state = "MENU"
night = 1
hacked = False
mask_on = False
cam_count = 0
n_data = {}
corrupt_parts = []

def log(text):
    out = document["game-output"]
    if hacked:
        document.body.classList.add("hacked")
        header = "<div class='corrupt-banner'>!! SYSTEMS CORRUPTED !!</div>\n"
    else:
        document.body.classList.remove("hacked")
        header = f"[NIGHT {night}] [{n_data['hr']} AM] [PWR: {int(n_data['pwr'])}%]\n"
    
    header += "="*40 + "\n"
    out.html = header + f"> {text}\n\n1-8: Cams | L/R: Doors | M: Mask | RESET: Reboot | 0: Wait"

def jumpscare(who):
    global state; state = "GAMEOVER"
    out = document["game-output"]
    document.body.classList.remove("hacked")
    out.html = f"<div style='color:red; text-align:center; padding-top:50px;'><h1>DEATH BY {who.upper()}</h1>"
    out.html += f"<p style='font-size:18px;'>\"{death_quotes.get(who, '...')}\"</p></div>"
    timer.set_timeout(show_menu, 5000)

def process_turn(cmd):
    global cam_count, mask_on, hacked, state
    n = n_data
    n["turn"] += 1
    
    if n["turn"] >= 10: 
        n["turn"] = 0; n["hr"] = 1 if n["hr"] == 12 else n["hr"] + 1
        if n["hr"] == 6: win_night(); return

    # Drain Logic
    drain = 1.2
    if n["l_door"]: drain += 2.0
    if n["r_door"]: drain += 2.0
    if mask_on: drain += 1.5
    n["pwr"] -= drain
    if n["pwr"] <= 0: jumpscare("Power Outage"); return

    msg = "Updating feed..."
    
    # Check Hacked State for command blocking
    if hacked and cmd in ["L", "R", "M", "RESET"]:
        msg = "ERROR: SYSTEM MALFUNCTION. PROTOCOL DISABLED."
    else:
        if cmd.isdigit() and 1 <= int(cmd) <= 8:
            if cam_count < 2:
                idx = int(cmd)-1; cam_count += 1; found = []
                if n["starr"]["pos"] == idx: found.append("STARR BABY")
                if n["diva"]["pos"] == idx: found.append("DIAMOND DIVA")
                if night >= 4 and idx == 7: # CAM 8 (Parts)
                    stages = ["(Sitting)", "(Standing Up...)", "(Almost Up)", "(STOOD UP)"]
                    found.append(f"GLITCH STARR {stages[n['glitch']['stage']]}")
                msg = f"CAM {cmd} ({cam_names[idx]}): " + (", ".join(found) if found else "No activity.")
            else: msg = "BUFFER OVERLOAD: Only 2 camera scans allowed per turn."
        elif cmd == "L": n["l_door"] = not n["l_door"]; msg = "Left Door Status Changed."
        elif cmd == "R": n["r_door"] = not n["r_door"]; msg = "Right Door Status Changed."
        elif cmd == "M": mask_on = not mask_on; msg = "Starr Mask Toggled."
        elif cmd == "RESET":
            if night >= 4 and n["glitch"]["stage"] != -1:
                if n["glitch"]["stage"] == 3: # Correct timing
                    n["glitch"]["stage"] = -1; n["glitch"]["wait"] = 5; n["glitch"]["ht"] = 0; hacked = False; msg = "SYSTEM REBOOT SUCCESSFUL."
                else: jumpscare("Glitch Starr"); return
            else: msg = "System reset ignored. No errors found."
        elif cmd == "0": msg = "You wait in silence..."

    cam_count = 0
    # AI Logic
    for bot, path, door, j_name in [("starr", [0,1,2,4,6], "r_door", "Starr Baby"), ("diva", [0,1,3,5], "l_door", "Diamond Diva")]:
        b = n[bot]
        if b["pos"] != path[-1]:
            b["wait"] -= 1
            if b["wait"] <= 0: b["pos"] = path[path.index(b["pos"])+1]; b["wait"] = random.randint(2, 4)
        else:
            if n[door]: b["pos"] = 0; b["wait"] = 3; b["dt"] = 0
            else:
                b["dt"] += 1
                if b["dt"] >= 2: jumpscare(j_name); return

    # Vent Logic (Pinky/Penelope)
    for girl, thresh in [("pinky", 2), ("penelope", 3)]:
        if night >= thresh:
            v = n[girl]; v["wait"] -= 1
            if v["wait"] <= 0: v["stage"] += 1; v["wait"] = 2
            if v["stage"] > 2:
                if not mask_on: jumpscare(girl.capitalize()); return
                else: v["stage"] = -1; v["wait"] = random.randint(4, 7)

    # Glitch Logic (Night 4+)
    if night >= 4:
        g = n["glitch"]
        if g["stage"] < 3:
            g["wait"] -= 1
            if g["wait"] <= 0: g["stage"] += 1; g["wait"] = 2
        else:
            g["ht"] += 1
            if g["ht"] >= 2: hacked = True; n["l_door"] = n["r_door"] = mask_on = False

    log(msg)

def win_night():
    global state; state = "WIN"
    document["game-output"].html = "<h1 style='color:lime; text-align:center; padding-top:60px;'>6:00 AM</h1>"
    timer.set_timeout(start_maint, 3000)

def start_maint():
    global state, corrupt_parts
    if night == 5:
        state = "ENDING"
        txt = "Danny Stephen: Jackson, you did it. The opening was a success.\n\nDanny: Here is your payment. It's... a lot more than we agreed. You saved this place.\n\nJackson: Danny, I'm done. I can't do another night in this place. I quit.\n\nDanny: I understand. Take thr money and go home, Jackson. Good luck out there..."
        document["game-output"].text = txt
        timer.set_timeout(lambda: window.location.reload(), 10000); return
    
    state = "BONUS"
    parts = ["Head", "Torso", "L-Arm", "R-Arm", "L-Leg", "R-Leg"]
    corrupt_parts = random.sample(parts, random.randint(2, 4))
    render_bonus()

def render_bonus():
    out = document["game-output"]
    out.html = f"MAINTENANCE MODE: {['Starr Baby','Diva','Pinky','Penelope'][night-1]}\nScan and purge all corrupt files.\n\n"
    for p in ["Head", "Torso", "L-Arm", "R-Arm", "L-Leg", "R-Leg"]:
        btn = html.BUTTON(f"SCAN {p}", ClassName="maint-btn")
        btn.bind("click", lambda e, part=p: check_part(part))
        out <= btn
    done = html.BUTTON("FINISH SHIFT", ClassName="maint-btn", style={"display":"block", "marginTop":"20px", "background":"#0f0"})
    done.bind("click", lambda e: finish_maint())
    out <= done

def check_part(p):
    global corrupt_parts
    if p in corrupt_parts: window.alert(f"{p}: !! CORRUPTION FOUND !! Purging..."); corrupt_parts.remove(p)
    else: window.alert(f"{p}: File Normal.")

def finish_maint():
    global night
    if not corrupt_parts: night += 1; show_menu()
    else: jumpscare(["Starr Baby","Diva","Pinky","Penelope"][night-1])

def show_menu():
    global state; state = "MENU"
    document.body.classList.remove("hacked")
    document["game-output"].text = f"STARR'S CENTRAL TERMINAL v3.5\n" + "-"*30 + f"\nNIGHT {night} READY\n\nType 1 and SEND to begin shift."

def start_story():
    global state, n_data, hacked, mask_on, cam_count
    state = "STORY"; hacked = False; mask_on = False; cam_count = 0
    stories = {
        1: "Danny Stephen: Jackson! Glad you're here. Welcome to Starr Baby's Party Place! We're opening in 5 days. Keep it safe.\nMelissa: Hi Jackson! I'm Melissa, your co-worker. Use L and R for the doors. Watch out for Starr Baby and Diamond Diva. Starr comes from the Right and Diamond from the left. Keep an eye on the cameras Jackson!",
        2: "Melissa: Time for another night. This time Pinky is active. She likes the Left Vent. If you hear her about to leave the vent, use the Starr Mask!",
        3: "Melissa: Penelope is loose. She uses the Right Vent. Same mask rules apply!",
        4: "Melissa: Hey Jackson.. Just wanted to let you know systems have been really glitchy lately... Workers have reported a glitchy version of Starr in parts and services... If it appears keep an eye on it... If it stands up reset the systems but never do it before that... Be careful Jackson...",
        5: "Melissa: This is the end. They're all coming for you. Just get to 6AM alive. Good luck..."
    }
    document["game-output"].text = stories.get(night, "") + "\n\n(Type 1 and SEND to Start Night)"

def handle_input(ev=None):
    val = document["user-input"].value.strip().upper()
    document["user-input"].value = ""
    if state == "MENU" and val == "1": start_story()
    elif state == "STORY" and val == "1":
        global state; state = "PLAYING"
        n_data.update({"hr": 12, "turn": 0, "pwr": 100, "starr": {"pos": 0, "wait": 3, "dt": 0}, "diva": {"pos": 0, "wait": 3, "dt": 0}, "pinky": {"stage": -1, "wait": 4}, "penelope": {"stage": -1, "wait": 4}, "glitch": {"stage": -1, "wait": 5, "ht": 0}, "l_door": False, "r_door": False})
        log("FEED ESTABLISHED.")
    elif state == "PLAYING": process_turn(val)

document["send-btn"].bind("click", handle_input)
document["user-input"].bind("keydown", lambda e: handle_input() if e.keyCode == 13 else None)
timer.set_timeout(show_menu, 500)
</script>
</body>
</html>
