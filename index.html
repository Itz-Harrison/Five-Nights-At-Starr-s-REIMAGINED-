<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>5 Night's at Starr's: REIMAGINED</title>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.12.0/brython.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.12.0/brython_stdlib.js"></script>
    <style>
        :root { --main-color: #FFFB00; --bg-color: #050505; }
        body { background-color: var(--bg-color); color: var(--main-color); font-family: 'Courier New', monospace; display: flex; flex-direction: column; align-items: center; height: 100vh; margin: 0; padding: 10px; overflow: hidden; }
        #top-ui { width: 95%; max-width: 750px; display: flex; gap: 5px; margin-bottom: 10px; z-index: 100; }
        #user-input { flex-grow: 1; background: #111; color: inherit; border: 2px solid currentColor; padding: 12px; font-size: 16px; outline: none; }
        #send-btn { background: currentColor; color: #000; border: none; padding: 12px 15px; font-weight: bold; border-radius: 4px; cursor: pointer; }
        #game-output { background-color: #000; color: inherit; padding: 15px; width: 95%; max-width: 750px; white-space: pre-wrap; font-size: 14px; border: 2px solid currentColor; flex-grow: 1; overflow-y: auto; position: relative; }

        /* Hacked State Styling */
        .hacked { --main-color: #00FF00 !important; animation: flicker 0.15s infinite; }
        @keyframes flicker {
            0% { transform: translate(0,0); }
            50% { transform: translate(-1px, 1px); opacity: 0.9; }
            100% { transform: translate(1px, -1px); }
        }
        .corrupt-banner { color: #00FF00; font-weight: bold; border: 1px solid #00FF00; padding: 5px; display: block; margin-bottom: 10px; text-align: center; }
        .btn { background: var(--main-color); color: #000; border: none; padding: 10px; cursor: pointer; font-weight: bold; margin: 5px; border-radius: 4px; }
    </style>
</head>
<body onload="brython()">
    <div id="top-ui">
        <input type="text" id="user-input" placeholder="COMMAND..." autocomplete="off">
        <button id="send-btn">SEND</button>
    </div>
    <div id="game-output">BOOTING STARR-OS...</div>

<script type="text/python">
from browser import document, window, timer, html
import random

# --- DATA & LORE ---
cam_names = ["Stage", "Play Area", "Arcade", "L Hall", "R Hall", "L Door", "R Door", "Parts"]
death_quotes = {
    "Starr Baby": "That's what you get for stealing my spotlight...",
    "Diamond Diva": "You were no match for my elegance...",
    "Princess Pinky": "Thought you could hide from me..?",
    "Penelope Purple": "Purple is the colour of revenge and despair...",
    "Glitch Starr": "Oh wow! I didn't even try to hack those systems and you still reset them..!"
}

state = "BOOT"
night = 1
hacked = False
mask_on = False
cam_count = 0
n_data = {}
corrupt_parts = []

def log(text):
    out = document["game-output"]
    if hacked:
        document.body.classList.add("hacked")
        header = "<div class='corrupt-banner'>!! SYSTEMS CORRUPTED !!</div>\n"
    else:
        document.body.classList.remove("hacked")
        header = f"[NIGHT {night}] [{n_data['hr']} AM] [PWR: {int(n_data['pwr'])}%]\n"
    
    header += "="*40 + "\n"
    out.html = header + f"> {text}\n\n1-8: Cams | L/R: Doors | M: Mask | RESET: Reboot | 0: Wait"

def jumpscare(who):
    global state; state = "GAMEOVER"
    out = document["game-output"]
    document.body.classList.remove("hacked")
    out.html = f"<div style='color:red; text-align:center; padding-top:50px;'><h1>DEATH BY {who.upper()}</h1>"
    out.html += f"<p style='font-size:18px;'>\"{death_quotes.get(who, '...')}\"</p></div>"
    timer.set_timeout(show_menu, 5000)

def process_turn(cmd):
    global cam_count, mask_on, hacked, state
    n = n_data
    n["turn"] += 1
    
    # Time Progression
    if n["turn"] >= 10: 
        n["turn"] = 0; n["hr"] = 1 if n["hr"] == 12 else n["hr"] + 1
        if n["hr"] == 6: win_night(); return

    # Power Logic
    drain = 1.2
    if n["l_door"]: drain += 2.0
    if n["r_door"]: drain += 2.0
    if mask_on: drain += 1.5
    n["pwr"] -= drain
    if n["pwr"] <= 0: jumpscare("Power Outage"); return

    msg = "Updating feed..."
    
    # Command Handling
    if hacked and cmd in ["L", "R", "M", "RESET"]:
        msg = "ERROR: COMMAND BLOCKED. SYSTEM CORRUPTED."
    else:
        if cmd.isdigit() and 1 <= int(cmd) <= 8:
            if cam_count < 2:
                idx = int(cmd)-1; cam_count += 1; found = []
                if n["starr"]["pos"] == idx: found.append("STARR BABY")
                if n["diva"]["pos"] == idx: found.append("DIAMOND DIVA")
                if night >= 4 and idx == 7: # CAM 8 is Parts
                    g_map = ["(Sitting)", "(Standing Up...)", "(Almost Up)", "(STOOD UP)"]
                    found.append(f"GLITCH STARR {g_map[n['glitch']['stage']]}")
                msg = f"CAM {cmd}: " + (", ".join(found) if found else "No movement detected.")
            else:
                msg = "BUFFER FULL: Max 2 camera scans per turn."
        elif cmd == "L": n["l_door"] = not n["l_door"]; msg = "Left Door Toggled."
        elif cmd == "R": n["r_door"] = not n["r_door"]; msg = "Right Door Toggled."
        elif cmd == "M": mask_on = not mask_on; msg = "Mask Toggled."
        elif cmd == "RESET":
            if night >= 4 and n["glitch"]["stage"] != -1:
                if n["glitch"]["stage"] == 3: # Only safe when STOOD UP
                    n["glitch"]["stage"] = -1; n["glitch"]["wait"] = 5; n["glitch"]["ht"] = 0; hacked = False; msg = "SYSTEM REBOOT SUCCESSFUL."
                else: jumpscare("Glitch Starr"); return
            else: msg = "Reset ignored. Hardware stable."
        elif cmd == "0": msg = "Standing by..."

    cam_count = 0
    # AI Logic
    for bot, path, door, j_name in [("starr", [0,1,2,4,6], "r_door", "Starr Baby"), ("diva", [0,1,3,5], "l_door", "Diamond Diva")]:
        b = n[bot]
        if b["pos"] != path[-1]:
            b["wait"] -= 1
            if b["wait"] <= 0:
                b["pos"] = path[path.index(b["pos"])+1]; b["wait"] = random.randint(2, 4)
        else:
            if n[door]: b["pos"] = 0; b["wait"] = 3; b["dt"] = 0
            else:
                b["dt"] += 1
                if b["dt"] >= 2: jumpscare(j_name); return

    # Vent Logic (Pinky/Penelope)
    for girl, thresh in [("pinky", 2), ("penelope", 3)]:
        if night >= thresh:
            v = n[girl]; v["wait"] -= 1
            if v["wait"] <= 0: v["stage"] += 1; v["wait"] = 2
            if v["stage"] > 2:
                if not mask_on: jumpscare(girl.capitalize()); return
                else: v["stage"] = -1; v["wait"] = random.randint(4, 7)

    # Glitch Logic
    if night >= 4:
        g = n["glitch"]
        if g["stage"] < 3:
            g["wait"] -= 1
            if g["wait"] <= 0: g["stage"] += 1; g["wait"] = 2
        else:
            g["ht"] += 1
            if g["ht"] >= 2: hacked = True; n["l_door"] = n["r_door"] = mask_on = False

    log(msg)

def win_night():
    global state; state = "WIN"
    document["game-output"].html = "<h1 style='color:lime; text-align:center; padding-top:60px;'>6:00 AM</h1>"
    timer.set_timeout(start_maintenance, 3000)

def start_maintenance():
    global state, corrupt_parts
    if night == 5:
        state = "ENDING"
        document["game-output"].text = "Danny Stephen: Incredible work, Jackson. You saved my father's legacy.\n\nDanny: Here is your paycheck. It's much larger than we agreed. You earned it.\n\nJackson: Thanks, Danny. But I'm quitting. I'm done with this place.\n\nDanny: I understand. Good luck out there."
        timer.set_timeout(lambda: window.location.reload(), 10000); return
    
    state = "BONUS"; parts = ["Head", "Torso", "L-Arm", "R-Arm", "L-Leg", "R-Leg"]
    corrupt_parts = random.sample(parts, random.randint(2, 4))
    render_bonus()

def render_bonus():
    out = document["game-output"]
    out.html = f"MAINTENANCE: {['Starr Baby','Diva','Pinky','Penelope'][night-1]}\nScan and clear all corrupt data.\n\n"
    for p in ["Head", "Torso", "L-Arm", "R-Arm", "L-Leg", "R-Leg"]:
        btn = html.BUTTON(f"SCAN {p}", ClassName="btn")
        btn.bind("click", lambda e, part=p: check_part(part))
        out <= btn
    done = html.BUTTON("DONE", ClassName="btn", style={"display":"block", "marginTop":"20px"})
    done.bind("click", lambda e: finish_bonus())
    out <= done

def check_part(p):
    global corrupt_parts
    if p in corrupt_parts: window.alert(f"{p}: !! CORRUPTED !! Resetting..."); corrupt_parts.remove(p)
    else: window.alert(f"{p}: Clean.")

def finish_bonus():
    global night
    if not corrupt_parts: night += 1; show_menu()
    else: jumpscare(["Starr Baby","Diva","Pinky","Penelope"][night-1])

def show_menu():
    global state; state = "MENU"
    document.body.classList.remove("hacked")
    document["game-output"].text = f"STARR'S CENTRAL TERMINAL v3.0\n" + "-"*30 + f"\nNIGHT {night} READY\n\nType 1 and SEND to begin."

def start_story():
    global state, n_data, hacked, mask_on, cam_count
    state = "STORY"; hacked = False; mask_on = False; cam_count = 0
    stories = {
        1: "Danny Stephen: Welcome to the Grand Opening! Jackson, stay sharp.\nMelissa: Watch the Doors! Starr (Right) and Diva (Left) are moving.",
        2: "Melissa: Pinky is in the Left Vent. Mask up when you hear her!",
        3: "Melissa: Penelope is in the Right Vent. Use the Mask!",
        4: "Melissa: The Glitch is in Parts. If he stands up, RESET. Don't touch it if he's sitting!",
        5: "Melissa: Final night. They are aggressive. Survive, Jackson."
    }
    document["game-output"].text = stories.get(night, "") + "\n\n(Type 1 and SEND to Start Night)"

def handle_input(ev=None):
    val = document["user-input"].value.strip().upper()
    document["user-input"].value = ""
    if state == "MENU" and val == "1": start_story()
    elif state == "STORY" and val == "1":
        global state; state = "PLAYING"
        n_data.update({"hr": 12, "turn": 0, "pwr": 100, "starr": {"pos": 0, "wait": 3, "dt": 0}, "diva": {"pos": 0, "wait": 3, "dt": 0}, "pinky": {"stage": -1, "wait": 4}, "penelope": {"stage": -1, "wait": 4}, "glitch": {"stage": -1, "wait": 5, "ht": 0}, "l_door": False, "r_door": False})
        log("FEED LIVE.")
    elif state == "PLAYING": process_turn(val)

document["send-btn"].bind("click", handle_input)
document["user-input"].bind("keydown", lambda e: handle_input() if e.keyCode == 13 else None)
timer.set_timeout(show_menu, 1000)
</script>
</body>
</html>
